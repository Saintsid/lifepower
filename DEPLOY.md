# ะะฝััััะบัะธั ะฟะพ ะดะตะฟะปะพั LifePower

## ๐๏ธ ะััะธัะตะบัััะฐ ะฟัะพะตะบัะฐ

### ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Nginx (ัะธััะตะผะฝัะน, ะฟะพัั 80/443)         โ
โ  - SSL/TLS (Let's Encrypt)              โ
โ  - ะะฐะทะดะฐะตั: /opt/lifepower/frontend/static/ โ
โ  - ะัะพะบัะธััะตั: /api/ โ 127.0.0.1:8002  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โโโโ ะกัะฐัะธะบะฐ (HTML/CSS/JS)
              โ
              โโโโ API ะทะฐะฟัะพัั
                    โ
                    โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ Docker Compose          โ
        โ  โโโโโโโโโโโโโโโโโโโโโ  โ
        โ  โ FastAPI           โ  โ
        โ  โ 127.0.0.1:8002    โ  โ
        โ  โโโโโโโโโโโโโโโโโโโโโ  โ
        โ           โ             โ
        โ  โโโโโโโโโโโโโโโโโโโโโ  โ
        โ  โ PostgreSQL        โ  โ
        โ  โ (ะฒะฝัััะตะฝะฝะธะน ะฟะพัั) โ  โ
        โ  โโโโโโโโโโโโโโโโโโโโโ  โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## โ ะงัะพ ะฑัะปะพ ะธัะฟัะฐะฒะปะตะฝะพ

### ะัะพะฑะปะตะผั ะบะพัะพััะต ะฑัะปะธ:
- โ Nginx ะฟะปะฐะฝะธัะพะฒะฐะปัั ะฒ Docker (ะบะพะฝัะปะธะบั ั ัะธััะตะผะฝัะผ)
- โ ะะพัั FastAPI ะฑัะป 127.0.0.1:8002 ะฒ docker-compose, ะฝะพ ะดะพะปะถะตะฝ ะฑัะป ะฑััั ะฒะฝะตัะฝะธะผ
- โ Frontend ะฑัะป ะฝะต ะฒ `/frontend/static/`, ะบะฐะบ ะพะถะธะดะฐะตั nginx

### ะงัะพ ะธัะฟัะฐะฒะปะตะฝะพ:
- โ ะฃะฑัะฐะฝ nginx ะธะท docker-compose (ะธัะฟะพะปัะทัะตััั ัะธััะตะผะฝัะน)
- โ FastAPI ะฑะธะฝะดะธััั ะฝะฐ 127.0.0.1:8002 (ะบะฐะบ ะฒ ะบะพะฝัะธะณะต nginx)
- โ Frontend ะฟะตัะตะผะตัะตะฝ ะฒ `/frontend/static/` (ะฟััั ะธะท nginx ะบะพะฝัะธะณะฐ)
- โ ะขะพะปัะบะพ backend + PostgreSQL ะฒ Docker

## ๐ ะงัะพ ะฟัะพะธะทะพะนะดะตั ะฟัะธ ะฟััะต

1. **GitHub Actions ะทะฐะฟัััะธััั** ะฐะฒัะพะผะฐัะธัะตัะบะธ
2. **rsync ัะบะพะฟะธััะตั** ะฒัะต ัะฐะนะปั ะฝะฐ ัะตัะฒะตั ะฒ `/opt/lifepower/`
3. **ะะฐ ัะตัะฒะตัะต ะฒัะฟะพะปะฝะธััั:**
   ```bash
   cd /opt/lifepower
   docker-compose down        # ะััะฐะฝะพะฒะบะฐ ััะฐััั ะบะพะฝัะตะนะฝะตัะพะฒ
   docker-compose build       # ะกะฑะพัะบะฐ backend ะพะฑัะฐะทะฐ
   docker-compose up -d       # ะะฐะฟััะบ FastAPI + PostgreSQL
   docker image prune -f      # ะัะธััะบะฐ
   ```
4. **Nginx ะฐะฒัะพะผะฐัะธัะตัะบะธ** ะฝะฐัะฝะตั ัะฐะทะดะฐะฒะฐัั ะพะฑะฝะพะฒะปะตะฝะฝัะต ัะฐะนะปั

## ๐ฆ ะงัะพ ะฑัะดะตั ะทะฐะฟััะตะฝะพ

| ะกะตัะฒะธั | ะะดะต | ะะพัั | ะะฟะธัะฐะฝะธะต |
|--------|-----|------|----------|
| Nginx | ะกะธััะตะผะฝัะน | 80, 443 | ะะฐะทะดะฐะตั ััะฐัะธะบั + SSL + ะฟัะพะบัะธััะตั API |
| FastAPI | Docker | 127.0.0.1:8002 | Backend API |
| PostgreSQL | Docker | ะะฝัััะตะฝะฝะธะน | ะะฐะทะฐ ะดะฐะฝะฝัั |

## ๐ ะะพัััะฟ ะฟะพัะปะต ะดะตะฟะปะพั

- **Frontend**: https://lifepower.su/
- **Backend API**: https://lifepower.su/api/
- **API Docs**: https://lifepower.su/api/docs
- **Health Check**: https://lifepower.su/api/health

## ๐ง ะงัะพ ะดะพะปะถะฝะพ ะฑััั ะฝะฐ ัะตัะฒะตัะต

### 1. โ ะกะธััะตะผะฝัะน Nginx ั ะฒะฐัะธะผ ะบะพะฝัะธะณะพะผ
```nginx
server {
    listen 443 ssl http2;
    server_name lifepower.su www.lifepower.su;

    root /opt/lifepower/frontend/static;
    index index.html;

    location / {
        try_files $uri $uri/ =404;
    }

    location /api/ {
        proxy_pass http://127.0.0.1:8002/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # SSL ัะตััะธัะธะบะฐัั ะธ ะฟัะพัะตะต...
}
```

### 2. โ Docker ะธ Docker Compose ัััะฐะฝะพะฒะปะตะฝั
```bash
docker --version
docker-compose --version
```

### 3. โ ะะฐะฟะบะฐ ัะพะทะดะฐะฝะฐ
```bash
ls -la /opt/lifepower
```

### 4. โ SSL ัะตััะธัะธะบะฐั ะฝะฐัััะพะตะฝ (Let's Encrypt)

## ๐ GitHub Secrets (ะดะพะปะถะฝั ะฑััั ะฝะฐัััะพะตะฝั)

| ะกะตะบัะตั | ะะฟะธัะฐะฝะธะต | ะัะธะผะตั |
|--------|----------|--------|
| `SSH_HOST` | IP ะธะปะธ ะดะพะผะตะฝ ัะตัะฒะตัะฐ | `123.45.67.89` ะธะปะธ `lifepower.su` |
| `SSH_USERNAME` | ะะพะปัะทะพะฒะฐัะตะปั SSH | `ubuntu` / `root` |
| `SSH_PRIVATE_KEY` | ะัะธะฒะฐัะฝัะน SSH ะบะปัั | `-----BEGIN OPENSSH...` |

## ๐งช ะะฐะบ ะฟัะพะฒะตัะธัั ะฟะพัะปะต ะดะตะฟะปะพั

### 1. GitHub Actions
ะกะผะพััะธะผ ััะพ workflow ะทะฐะฒะตััะธะปัั ััะฟะตัะฝะพ โ

### 2. ะะฐ ัะตัะฒะตัะต (ัะตัะตะท SSH)
```bash
ssh user@lifepower.su
cd /opt/lifepower

# ะัะพะฒะตัะธัั ะบะพะฝัะตะนะฝะตัั
docker-compose ps

# ะะพะปะถะฝะพ ะฑััั 2 ะบะพะฝัะตะนะฝะตัะฐ "Up":
# - lifepower_api (FastAPI)
# - lifepower_db (PostgreSQL)
```

### 3. ะัะพะฒะตัะธัั ะปะพะณะธ
```bash
# FastAPI
docker-compose logs -f fastapi

# PostgreSQL
docker-compose logs -f postgres

# Nginx
sudo tail -f /var/log/nginx/lifepower_access.log
```

### 4. ะัะพะฒะตัะธัั ัะตัะตะท curl/ะฑัะฐัะทะตั
```bash
# Health check
curl https://lifepower.su/api/health
# {"status": "ok"}

# ะะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ
curl -I https://lifepower.su/
# 200 OK
```

### 5. ะัะบัััั ะฒ ะฑัะฐัะทะตัะต
- https://lifepower.su/ - ะดะพะปะถะตะฝ ะพัะบัััััั ัะฐะนั
- https://lifepower.su/api/docs - Swagger UI

## ๐ฏ ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั

ะัะธ ะฟัะฐะฒะธะปัะฝัั ัะตะบัะตัะฐั ะธ ะฝะฐัััะพะนะบะฐั:
- โ Workflow ะทะฐะฒะตััะธััั ััะฟะตัะฝะพ (ะทะตะปะตะฝะฐั ะณะฐะปะพัะบะฐ)
- โ ะะฐ ัะตัะฒะตัะต 2 ะบะพะฝัะตะนะฝะตัะฐ ะฒ ััะฐัััะต "Up"
- โ https://lifepower.su/ ะพัะบััะฒะฐะตั ัะฐะนั
- โ https://lifepower.su/api/health ะพัะฒะตัะฐะตั `{"status": "ok"}`
- โ SSL ัะฐะฑะพัะฐะตั (ะทะตะปะตะฝัะน ะทะฐะผะพะบ ะฒ ะฑัะฐัะทะตัะต)

## โ๏ธ ะัะปะธ ััะพ-ัะพ ะฟะพัะปะพ ะฝะต ัะฐะบ

### ะัะพะฑะปะตะผะฐ: 502 Bad Gateway ะฝะฐ /api/

**ะะตัะตะฝะธะต:**
```bash
# ะัะพะฒะตัะธัั ััะพ FastAPI ะทะฐะฟััะตะฝ
docker-compose ps

# ะัะพะฒะตัะธัั ะปะพะณะธ
docker-compose logs fastapi

# ะัะพะฒะตัะธัั ะฟะพัั 8002
netstat -tulpn | grep 8002
# ะะพะปะถะตะฝ ะฑััั: 127.0.0.1:8002

# ะะตัะตะทะฐะฟัััะธัั
docker-compose restart fastapi
```

### ะัะพะฑะปะตะผะฐ: ะกัะฐัะธะบะฐ ะฝะต ะพะฑะฝะพะฒะธะปะฐัั

**ะะตัะตะฝะธะต:**
```bash
# ะัะพะฒะตัะธัั ัะฐะนะปั
ls -la /opt/lifepower/frontend/static/

# ะัะธััะธัั ะบัั nginx
sudo nginx -s reload
```

### ะัะพะฑะปะตะผะฐ: Database connection error

**ะะตัะตะฝะธะต:**
```bash
# ะัะพะฒะตัะธัั PostgreSQL
docker-compose logs postgres

# ะะตัะตะทะฐะฟัััะธัั
docker-compose restart postgres

# ะัะพะฒะตัะธัั ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั ะฒ docker-compose.yml
```

### ะัะพะฑะปะตะผะฐ: GitHub Actions failed

**ะะตัะตะฝะธะต:**
1. ะกะผะพััะธะผ ะปะพะณะธ ะฒ GitHub โ Actions
2. ะัะพะฒะตััะตะผ ัะตะบัะตัั (SSH_HOST, SSH_USERNAME, SSH_PRIVATE_KEY)
3. ะัะพะฒะตััะตะผ SSH ะดะพัััะฟ ะฒัััะฝัั:
   ```bash
   ssh user@server
   ```

## ๐ ะะตะทะพะฟะฐัะฝะพััั

โ **ะงัะพ ัะถะต ะฝะฐัััะพะตะฝะพ:**
- SSL/TLS ัะตััะธัะธะบะฐั
- FastAPI ะดะพัััะฟะตะฝ ัะพะปัะบะพ ะฝะฐ localhost
- PostgreSQL ะธะทะพะปะธัะพะฒะฐะฝ ะฒ Docker

โ๏ธ **ะะต ะทะฐะฑััั:**
1. ะกะผะตะฝะธัั ะฟะฐัะพะปั ะะ ะฒ `docker-compose.yml`:
   ```yaml
   POSTGRES_PASSWORD: changeme  # โ ะะะะะะะขะฌ!
   ```

2. ะัะพะฒะตัะธัั firewall:
   ```bash
   sudo ufw status
   # ะะพะปะถะฝั ะฑััั ะพัะบัััั ัะพะปัะบะพ: 22, 80, 443
   ```

## ๐ ะกัััะบัััะฐ ัะฐะนะปะพะฒ ะฝะฐ ัะตัะฒะตัะต ะฟะพัะปะต ะดะตะฟะปะพั

```
/opt/lifepower/
โโโ frontend/
โ   โโโ static/              # Nginx ัะฐะทะดะฐะตั ะพัััะดะฐ
โ       โโโ index.html
โ       โโโ about.html
โ       โโโ services.html
โ       โโโ contacts.html
โ       โโโ css/
โ       โโโ js/
โ       โโโ {css,js,images}/
โโโ backend/
โ   โโโ app/
โ   โ   โโโ main.py
โ   โโโ Dockerfile
โ   โโโ requirements.txt
โโโ docker-compose.yml       # ะะฐะฟััะบะฐะตั FastAPI + PostgreSQL
โโโ .github/
```

## ๐ก ะะพัะปะต ััะฟะตัะฝะพะณะพ ะดะตะฟะปะพั

1. โ ะัะพะฒะตัะธัั ะฒัะต ัััะฐะฝะธัั ัะฐะนัะฐ
2. โ ะัะพะฒะตัะธัั API endpoints
3. โ ะะฐัััะพะธัั ะผะพะฝะธัะพัะธะฝะณ (ะพะฟัะธะพะฝะฐะปัะฝะพ)
4. โ ะะฐัััะพะธัั ะฐะฒัะพะผะฐัะธัะตัะบะธะต ะฑัะบะฐะฟั ะะ
5. โ ะกะผะตะฝะธัั ะดะตัะพะปัะฝัะต ะฟะฐัะพะปะธ!

---

**ะะพัะพะฒะพ ะบ ะดะตะฟะปะพั!** ๐

ะขะฒะพะน nginx ัะถะต ะฝะฐัััะพะตะฝ, SSL ัะฐะฑะพัะฐะตั, ะพััะฐะตััั ัะพะปัะบะพ ะทะฐะฟััะธัั ะธ Docker Compose ะฟะพะดะฝะธะผะตั backend ั ะะ.

---

ยฉ 2025 ะกะธะปะฐ ะถะธะทะฝะธ. ะะทะดะพัะพะฒะธัะตะปัะฝัะน ัะตะฝัั ะฒ ะขะฐะณะฐะฝัะพะณะต.
